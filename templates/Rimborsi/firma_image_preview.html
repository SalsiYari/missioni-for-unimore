{% extends "Rimborsi/base.html" %}
{% load crispy_forms_tags %}
{% load static %}
{% block title %}Profilo{% endblock %}

{% block content %}
    {% spaceless %}
    
        <h1>Preview Image</h1>
    <img id="firma-image" src="{{ img_url }}" alt="Firma Image" style="width: 300px; height: auto;">

    <br><br>

    <button id="rotate-button">Ruota Immagine</button>
    <button id="save-button">Salva Immagine</button>

    <script>
        // Ruotare l'immagine (non salva nel DB)
        $('#rotate-button').on('click', function () {
            $.ajax({
                url: "",  // Usa l'URL corrente
                type: "POST",
                data: {
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    rotate: true  // Indica che stiamo ruotando l'immagine
                },
                success: function (response) {
                    if (response.status === 'success') {
                        // Aggiorna l'immagine per vedere l'anteprima della rotazione
                        $('#firma-image').attr('src', $('#firma-image').attr('src') + '?' + new Date().getTime());
                    } else {
                        alert('Errore: ' + response.message);
                    }
                }
            });
        });

        // Salvare l'immagine ruotata nel DB
        $('#save-button').on('click', function () {
            $.ajax({
                url: "",  // Usa l'URL corrente
                type: "POST",
                data: {
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    save: true  // Indica che vogliamo salvare l'immagine
                },
                success: function (response) {
                    // Dopo il salvataggio, fai il redirect alla pagina profilo
                    window.location.href = '/profile';
                }
            });
        });
    </script>



    {% endspaceless %}
{% endblock %}